{{extend './layout_login.html'}}

{{block 'oacontent'}}
<div class="login-tabib">
        <div class="login-main">
            <form id="login_form">
                <h5 class="text-center"  >Welcome to Almond Boats</h5>
                <div class="form-group m-b-10">
                    <label class="col-form-label">User name</label>
                    <input class="form-control" id="email" type="email" name="email" placeholder="Email Address">
                </div>
                <div class="form-group m-b-10">
                    <label class="col-form-label">Password</label>
                    <div class="form-input position-relative">
                        <input class="form-control" id="password" type="password" name="password" placeholder="Password">
                        <div class="show-hide"><span class="show"></span></div>
                    </div>
                </div>
                <div class="form-group mb-0">
                    <div class="checkbox p-0">
                        <input  type="checkbox" id="remember">
                        <label class="text-muted" for="remember">Remember password</label>
                    </div>
                    <a class="link text-primary" href="page-forgot-password.html">Forgot password?</a>
                    <div class="mt-3">
                        <button type="submit"  class="btn btn-primary w-100">Sign in</button>
                    </div>
                </div>
            </form>
        </div>
</div>
{{/block}}
{{block 'oascript'}}
<script>
    $('#login_form').on('submit', function (e) {
      e.preventDefault()
      var formData = $(this).serialize()
      console.log(formData)
      $.ajax({
        url: '/oa/login',
        type: 'post',
        data: formData,
        dataType: 'json',
        success: function (data) {
          var err_code = data.err_code
          if (err_code === 0) {
            window.location.href = '/oa/index'
          } else if (err_code === 1) {
            window.alert('email or password error')
          } else if (err_code === 500) {
            window.alert('server error')
          }
        }
      })
    })


     // remember password  
     var oForm = document.getElementById('login_form');
        var oUser = document.getElementById('email');
        var oPswd = document.getElementById('password');
        var oRemember = document.getElementById('remember');

        if(getCookie('email') && getCookie('password')){
            oUser.value = getCookie('email');
            oPswd.value = getCookie('password');
            oRemember.checked = true;
        }

        oRemember.onchange = function(){
            if(!this.checked){
                delCookie('email');
                delCookie('password');
            }
        };

        oForm.onsubmit = function(){
            if(remember.checked){ 
                setCookie('email',oUser.value,7); //保存帐号到cookie，有效期7天
                setCookie('password',oPswd.value,7); //保存密码到cookie，有效期7天
            }
        };
    

    function setCookie(name,value,day){
        var date = new Date();
        date.setDate(date.getDate() + day);
        document.cookie = name + '=' + value + ';expires='+ date;
    };

    function getCookie(name){
        var reg = RegExp(name+'=([^;]+)');
        var arr = document.cookie.match(reg);
        if(arr){
            return arr[1];
        }else{
            return '';
        }
    };

    function delCookie(name){
        setCookie(name,null,-1);
    };
  </script>
{{/block}}